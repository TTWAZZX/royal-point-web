<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Äì Royal Point</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f8fafc; font-family: 'Kanit', sans-serif; }

    .reward-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
      padding: 16px;
    }

    .reward-card {
      position: relative;
      border-radius: 14px;
      background: #fff;
      border: 1px solid #e2e8f0;
      box-shadow: 0 3px 10px rgba(0,0,0,0.06);
      overflow: hidden;
      transition: transform .15s ease;
    }
    .reward-card:hover {
      transform: translateY(-3px);
    }

    .reward-card img {
    width: 100%;
    height: 140px;
    object-fit: contain;
    background: #fff;
    padding: 6px;
    border-radius: 12px;  /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á */
    }

    .reward-name {
      font-weight: 600;
      font-size: 0.95rem;
      padding: 6px 10px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .reward-cost {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f0fdfa;
      color: #047857;
      padding: 2px 8px;
      font-weight: 700;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid #94d6c3;
    }

    /* ‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡πá‡∏Å + ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô */
    .reward-stock {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(0,0,0,0.65);
      padding: 2px 8px;
      font-size: 0.70rem;   
      border-radius: 6px;
      color: #fff;
      font-weight: 600;
      z-index: 10;
    }

    .reward-card.soldout::after {
      content: "‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß";
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.75);
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 900;
      color: #b91c1c;
      font-size: 1.1rem;
    }
  </style>
</head>

<body>

  <div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold text-success m-0">üéÅ ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>

    <a href="/" class="text-success" style="font-size: 1.45rem;">
      <i class="fa-solid fa-arrow-left-long"></i>
    </a>
  </div>

    <div id="rewardGrid" class="reward-grid">
      <!-- JS Render -->
    </div>
  </div>

  <script>
    async function loadAllRewards() {
      const res = await fetch('/api/rewards?include=1', { cache:'no-store' });
      const j = await res.json();

      const list = (j.items || []).map(x => ({
        id   : x.id,
        name : x.name,
        cost : Number(x.cost || 0),
        img  : x.img,
        stock     : Number(x.stock     ?? 0),
        stock_max : Number(x.stock_max ?? 0),
        sort_index: Number(x.sort_index ?? 999),
      }));

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ stock ‡∏Å‡πà‡∏≠‡∏ô + ‡∏ï‡∏≤‡∏° sort_index
      list.sort((a, b) => {
        const sa = a.stock;
        const sb = b.stock;
        if (sa <= 0 && sb > 0) return 1;
        if (sb <= 0 && sa > 0) return -1;
        return a.sort_index - b.sort_index;
      });

      renderGrid(list);
    }

    function renderGrid(list) {
    const wrap = document.getElementById('rewardGrid');
    wrap.innerHTML = list.map(r => `
    <div class="reward-card ${r.stock <= 0 ? 'soldout' : ''}">
      
      <img src="${r.img}" alt="${r.name}">

      <div class="reward-cost">${r.cost} pt</div>

      <div class="reward-stock">
        ${r.stock <= 0 ? '‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß' : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${r.stock}/${r.stock_max}`}
      </div>

      <div class="reward-name">${r.name}</div>

    </div>
    `).join("");
    }

    loadAllRewards();
  </script>

</body>
</html>
