<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Äì Royal Point</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">

  <style>
    body { background:#f8fafc; font-family: 'Kanit', sans-serif; }
    
    .reward-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
      padding: 8px;
    }

    .reward-card {
      position: relative;
      border-radius: 14px;
      background: #fff;
      border: 1px solid #e2e8f0;
      box-shadow: 0 3px 10px rgba(0,0,0,0.06);
      overflow: hidden;
      transition: transform 0.2s;
    }
    .reward-card:active { transform: scale(0.98); }

    .reward-card img {
      width: 100%;
      height: 140px;
      object-fit: contain;
      background: #fff;
      padding: 8px;
    }

    .reward-name {
      font-weight: 600;
      font-size: 0.95rem;
      padding: 6px 10px 0;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .reward-cost {
      position: absolute;
      top: 8px; right: 8px;
      background: #f0fdfa; color: #047857;
      padding: 2px 8px;
      font-weight: 700; border-radius: 999px; font-size: 0.75rem;
      border: 1px solid #94d6c3; z-index: 10;
    }

    .reward-stock {
      position: absolute;
      top: 8px; left: 8px;
      background: rgba(0,0,0,0.65);
      padding: 2px 8px; font-size: 0.7rem;
      border-radius: 6px; color: #fff; font-weight: 600; z-index: 10;
    }

    .reward-footer { padding: 6px 10px 10px; }

    .reward-card.soldout { opacity: 0.6; pointer-events: none; filter: grayscale(1); }
    .reward-card.soldout::after {
      content: "‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß";
      position: absolute; inset: 0;
      background: rgba(255,255,255,0.5);
      display: flex; justify-content: center; align-items: center;
      font-weight: 900; color: #b91c1c; font-size: 1.2rem; z-index: 20;
      transform: rotate(-15deg);
    }
    
    /* Skeleton Animation */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
    }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏ô <style> */
    .reward-card.locked { filter: grayscale(1); opacity: 0.8; }
    .reward-card.locked .reward-footer button { 
      background-color: #94a3b8; 
      border-color: #94a3b8; 
      cursor: not-allowed; 
    }
    .reward-card.locked::after {
      content: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠";
      position: absolute; inset: 0;
      background: rgba(255,255,255,0.3);
      display: flex; justify-content: center; align-items: center;
      font-weight: 800; color: #64748b; font-size: 1.1rem; z-index: 20;
      transform: rotate(-10deg);
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á soldout ‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö locked ‡πÑ‡∏î‡πâ */
    .reward-card.soldout::after {
      content: "‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß";
      color: #b91c1c;
    }
  </style>
</head>

<body>

<div id="topProgress" style="position:fixed;top:0;left:0;right:0;height:3px;z-index:9999;display:none;">
  <div id="topProgressBar" style="height:100%;background:#10b981;width:100%;transform-origin:0 50%;transform:scaleX(0);"></div>
</div>

<div id="appOverlay" class="loading-overlay">
  <div class="box">
    <div class="spinner-border text-primary" role="status" style="width: 1.5rem; height: 1.5rem;"></div>
    <span id="overlayMsg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</span>
  </div>
</div>

<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold text-success m-0">üéÅ ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <a href="/" class="text-secondary fs-4" onclick="goBack(event)">
      <i class="fa-solid fa-circle-left"></i>
    </a>
  </div>

  <div id="skeletonGrid" class="reward-grid">
    <script>
      for(let i=0; i<8; i++) {
        document.write(`
          <div class="reward-card p-2" style="height:240px">
            <div class="skeleton w-100 h-50 mb-2"></div>
            <div class="skeleton w-75 h-25 mx-auto mb-2"></div>
            <div class="skeleton w-100 h-25"></div>
          </div>
        `);
      }
    </script>
  </div>

  <div id="rewardGrid" class="reward-grid d-none"></div>

</div>

<script src="loader.js"></script> 
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 

<script>

// 1. ‡∏î‡∏∂‡∏á UID
const getUid = () => {
  const params = new URLSearchParams(window.location.search);
  return params.get('uid') || sessionStorage.getItem('uid') || localStorage.getItem('uid');
};

// ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
let CURRENT_SCORE = 0;

/* ===============================
   LOAD DATA (Rewards + Score)
================================ */
async function loadAllRewards() {
  const grid = document.getElementById('rewardGrid');
  const skel = document.getElementById('skeletonGrid');
  const uid  = getUid();
  
  try {
    // ‚≠ê ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ‡πÅ‡∏•‡∏∞ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
    const [rewardsRes, scoreRes] = await Promise.allSettled([
       Loading.apiFetch('/api/rewards?include=1', {cache:'no-store'}),
       fetch(`/api/get-score?uid=${uid}`, {cache:'no-store'}).then(r=>r.json())
    ]);

    // 1) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    if (scoreRes.status === 'fulfilled' && scoreRes.value?.data) {
       // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
       const d = scoreRes.value.data;
       CURRENT_SCORE = Number(d.score || d.points || d.point || d.balance || 0);
       // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
       localStorage.setItem(`RP_SCORE:${uid}`, CURRENT_SCORE);
    } else {
       // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
       CURRENT_SCORE = Number(localStorage.getItem(`RP_SCORE:${uid}`) || 0);
    }

    // 2) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    let list = [];
    if (rewardsRes.status === 'fulfilled') {
        const j = rewardsRes.value;
        list = (j.items || j.data || []).map(x => ({
          id: x.id,
          name: x.name,
          cost: Number(x.cost || 0),
          img: x.img || 'https://placehold.co/300x300?text=No+Image',
          stock: Number(x.stock ?? 0),
          stock_max: Number(x.stock_max ?? 0),
          sort_index: Number(x.sort_index ?? 999),
        }));
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
    list.sort((a,b)=>{
      if (a.stock <= 0 && b.stock > 0) return 1;
      if (b.stock <= 0 && a.stock > 0) return -1;
      return a.sort_index - b.sort_index;
    });

    renderGrid(list);

    skel.classList.add('d-none');
    grid.classList.remove('d-none');

  } catch (err) {
    console.error(err);
    skel.innerHTML = `<div class="col-12 text-center text-danger mt-5">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
  }
}

/* ===============================
   RENDER GRID
================================ */
function renderGrid(list) {
  const wrap = document.getElementById('rewardGrid');
  
  wrap.innerHTML = list.map(r => {
    const isSoldOut = r.stock <= 0;
    const isLocked  = !isSoldOut && (CURRENT_SCORE < r.cost); // ‚≠ê ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

    // Escape ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
    const safeName = r.name.replace(/'/g, "\\'").replace(/"/g, "&quot;");
    const safeImg  = r.img.replace(/'/g, "\\'").replace(/"/g, "&quot;");

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏•‡∏≤‡∏™
    let cls = 'reward-card';
    if (isSoldOut) cls += ' soldout';
    else if (isLocked) cls += ' locked';

    return `
    <div class="${cls}" id="card-${r.id}">
      <img src="${r.img}" alt="${r.name}" loading="lazy">
      <div class="reward-cost">${r.cost} pt</div>
      
      <div class="reward-stock" id="stock-${r.id}" 
           data-stock="${r.stock}" 
           data-max="${r.stock_max}">
        ${isSoldOut ? '‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß' : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${r.stock}/${r.stock_max}`}
      </div>

      <div class="reward-name">${r.name}</div>
      <div class="reward-footer">
        <button
          class="btn btn-sm btn-success w-100 rounded-pill fw-bold"
          onclick="redeemReward('${r.id}', '${safeName}', ${r.cost}, '${safeImg}')"
          ${isSoldOut || isLocked ? 'disabled' : ''}>
          ${isLocked ? '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠' : '‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•'}
        </button>
      </div>
    </div>
  `}).join('');
}

/* ===============================
   REDEEM FUNCTION (Updated)
================================ */
async function redeemReward(rewardId, rewardName, cost, rewardImg) {
  const uid = getUid();
  if (!uid) {
    Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà', 'warning');
    return;
  }

  // 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ù‡∏±‡πà‡∏á Client ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
  if (CURRENT_SCORE < cost) {
    Swal.fire('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠', `‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ ${CURRENT_SCORE} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏ï‡πà‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ ${cost} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`, 'error');
    return;
  }

  // 2. Popup ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏ß‡∏¢‡πÜ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
  const confirm = await Swal.fire({
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å?',
    html: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å <b>${rewardName}</b><br>‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô <b>${cost}</b> pt`,
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: '‡πÅ‡∏•‡∏Å‡πÄ‡∏•‡∏¢',
    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    confirmButtonColor: '#198754'
  });

  if (!confirm.isConfirmed) return;

  try {
    // 3. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
    await Loading.apiFetch('/api/spend', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({ uid, rewardId, cost })
    }, { scope: 'overlay', msg: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...' });

    // 4. ‡∏ï‡∏±‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ‡πÅ‡∏•‡∏∞ LocalStorage ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    CURRENT_SCORE = Math.max(0, CURRENT_SCORE - cost);
    localStorage.setItem(`RP_SCORE:${uid}`, CURRENT_SCORE);
    
    // 5. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI (‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å + ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏≠‡∏∑‡πà‡∏ô‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÅ‡∏•‡πâ‡∏ß)
    updateUiAfterSpend(rewardId, cost);

    // 6. Popup ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏°‡∏µ‡∏£‡∏π‡∏õ)
    await Swal.fire({
        title: "‡πÅ‡∏•‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ",
        imageUrl: rewardImg || undefined,
        imageWidth: 150,
        imageHeight: 'auto',
        imageAlt: rewardName,
        html: `
          <h5 class="fw-bold text-dark mt-2">${rewardName}</h5>
          <div class="mb-3 text-muted">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ <span class="badge bg-danger rounded-pill">${cost} pt</span></div>
          <div class="alert alert-warning small p-2">
             <i class="fa-solid fa-camera"></i> ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
          </div>
        `,
        confirmButtonText: "‡∏ï‡∏Å‡∏•‡∏á",
        confirmButtonColor: "#22c55e"
    });

  } catch (err) {
    console.error(err);
    Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ', 'error');
  }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å / ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏∏‡πà‡∏°‡∏•‡πá‡∏≠‡∏Ñ)
function updateUiAfterSpend(rewardId, cost) {
    // ‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å
    const stockEl = document.getElementById(`stock-${rewardId}`);
    const cardEl = document.getElementById(`card-${rewardId}`);
    const btnEl = cardEl?.querySelector('button');

    if (stockEl) {
        let currentStock = parseInt(stockEl.getAttribute('data-stock') || '0');
        let maxStock = stockEl.getAttribute('data-max');
        let newStock = currentStock - 1;
        stockEl.setAttribute('data-stock', newStock);

        if (newStock <= 0) {
            stockEl.textContent = "‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß";
            cardEl.classList.add('soldout');
            if(cardEl.classList.contains('locked')) cardEl.classList.remove('locked'); // ‡πÄ‡∏≠‡∏≤ locked ‡∏≠‡∏≠‡∏Å‡∏ñ‡πâ‡∏≤ soldout ‡πÅ‡∏•‡πâ‡∏ß
            if (btnEl) { btnEl.disabled = true; btnEl.textContent = '‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•'; }
        } else {
            stockEl.textContent = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${newStock}/${maxStock}`;
        }
    }

    // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏≠‡∏∑‡πà‡∏ô: ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô Locked ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    const allCards = document.querySelectorAll('.reward-card');
    allCards.forEach(card => {
        // ‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß
        if (card.classList.contains('soldout')) return;

        // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≤‡∏Å DOM (‡πÅ‡∏Å‡∏∞‡∏à‡∏≤‡∏Å text "XX pt" ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö data-cost ‡πÑ‡∏ß‡πâ)
        // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å HTML ‡∏ó‡∏µ‡πà render ‡πÑ‡∏ß‡πâ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö data-cost ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà card ‡∏ï‡∏≠‡∏ô renderGrid)
        // ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î renderGrid ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô ‡∏ú‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà data-cost ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà card element ‡∏´‡∏•‡∏±‡∏Å
        // ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ re-render ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö class ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏≠‡∏≤
        
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î: ‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≤‡∏Å .reward-cost
        const costEl = card.querySelector('.reward-cost');
        if (costEl) {
            const thisCost = parseInt(costEl.textContent);
            const btn = card.querySelector('button');
            if (CURRENT_SCORE < thisCost) {
                card.classList.add('locked');
                if (btn) { btn.disabled = true; btn.textContent = '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠'; }
            }
        }
    });
}

function goBack(e) {
  e.preventDefault();
  sessionStorage.setItem('FORCE_REFRESH', '1'); 
  window.location.href = '/'; // ‡∏´‡∏£‡∏∑‡∏≠ index.html
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
loadAllRewards();

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>