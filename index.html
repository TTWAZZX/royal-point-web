<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Royal Point</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <!-- main style -->
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- top progress bar -->
  <div id="topbar"></div>

  <div class="container py-3">
    <!-- Skeleton (shown while loading) -->
    <section id="appSkeleton" class="rp-card p-4 mb-3" style="display:none">
      <div class="d-flex align-items-center gap-3">
        <div class="skel" style="width:80px;height:80px;border-radius:50%"></div>
        <div class="flex-grow-1">
          <div class="skel skel-line" style="width:40%"></div>
          <div class="skel skel-line" style="width:30%"></div>
          <div class="skel skel-line" style="width:60%"></div>
        </div>
      </div>
    </section>

    <!-- Header Card -->
    <section class="rp-card p-3 mb-3">
      <div class="d-flex gap-3">
        <!-- Left: avatar + tier badge -->
        <div class="rp-left text-center">
          <div class="position-relative d-inline-block">
            <img id="profilePic" src="https://placehold.co/120x120" class="rounded-circle" width="84" height="84" alt="avatar">
            <span id="levelBadge" class="badge bg-secondary position-absolute top-0 start-0 translate-middle rp-level-silver">Silver</span>
          </div>
        </div>

        <!-- Right: name + status + meters -->
        <div class="rp-right flex-grow-1">
          <div class="d-flex align-items-center gap-2">
            <h4 id="username" class="mb-0">—</h4>
            <button id="refreshBtn" class="btn btn-sm btn-outline-secondary" title="รีเฟรชคะแนน">
              <i class="fa-solid fa-rotate"></i>
            </button>
            <a id="btnAdmin" href="/admin.html" class="btn btn-sm btn-outline-success d-none" title="ไปหน้าแอดมิน">
              <i class="fa-solid fa-shield-halved"></i>
            </a>
          </div>

          <!-- Level text -->
          <div class="small text-secondary mt-1">ระดับปัจจุบัน: <span id="currentLevelText">Silver</span></div>

          <!-- Next tier hint -->
          <div id="next-tier" class="small text-secondary rp-next">—</div>

          <!-- Level Meter (ย้ายมาไว้ใน rp-right) -->
          <div id="levelMeter" class="lm-wrap mt-2">
            <div class="lm-track">
              <div id="lm-fill" class="lm-fill"></div>
              <div class="lm-tick" style="left:0%"    data-label="Silver 0"></div>
              <div class="lm-tick" style="left:41.67%" data-label="Gold 500"></div>
              <div class="lm-tick" style="left:100%"   data-label="Platinum 1200"></div>
            </div>
            <div id="lm-label" class="lm-label small text-secondary mt-1">—</div>
          </div>

          <!-- Big points -->
          <div class="display-5 fw-bold mt-2"><span id="points">0</span> <span class="fs-6">pt</span></div>

          <!-- Progress line (เก่า) -->
          <div id="progressBar" class="rp-progress-line mt-2 prog-silver">
            <div id="progressFill" class="rp-progress-fill"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <div class="d-grid gap-2 mb-3">
      <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#scoreModal">
        <i class="fa-solid fa-qrcode me-1"></i> สแกนเพื่อรับคะแนน
      </button>

      <button id="historyBtn" class="btn btn-outline-secondary">
        <i class="fa-regular fa-clock me-1"></i> ประวัติการรับคะแนน
      </button>
    </div>

    <!-- Rewards -->
    <section class="mb-4">
      <h5 class="mb-2">ของรางวัล</h5>
      <div id="rewardRail" class="rp-reward-rail d-grid gap-2"></div>
    </section>
  </div>

  <!-- Modal: Scanner / Enter code -->
  <div class="modal fade" id="scoreModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">รับคะแนน</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="qr-reader" class="border rounded p-2 mb-2" style="min-height:260px"></div>
          <div class="d-flex gap-2 mb-2">
            <button id="startScanBtn" class="btn btn-outline-primary flex-fill"><i class="fa-solid fa-camera me-1"></i> เริ่มกล้อง</button>
            <button id="stopScanBtn" class="btn btn-outline-secondary flex-fill"><i class="fa-solid fa-stop me-1"></i> ปิดกล้อง</button>
          </div>
          <div class="input-group">
            <input id="secretCode" type="text" class="form-control" placeholder="หรือกรอกรหัสลับ">
            <button id="submitCodeBtn" class="btn btn-primary">ยืนยันรับคะแนน</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: History -->
  <div class="modal fade" id="historyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ประวัติของ <span id="historyUser">—</span></h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="historyList" class="list-group"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- (ไม่จำเป็น แต่ถ้ามี LoadingOverlay ใน app.js จะใช้ได้) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>

  <!-- App logic -->
  <script src="/app.js" defer></script>
</body>
</html>
